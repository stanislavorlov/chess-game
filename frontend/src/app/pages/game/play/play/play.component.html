<mat-card class="cardWithShadow theme-card">
    <mat-card-header *ngIf="game">
        <mat-form-field appearance="outline" class="w-100 game-name">
            <input matInput type="text" [(ngModel)]="game.name">
        </mat-form-field>
    </mat-card-header>
    <mat-card-content class="b-t-1">
        <div class="row">
            <div class="col-lg-7">
                <div class="row player-indicator" [class.active]="game.turn.value === 'W'" *ngIf="game">
                    <div style="font-weight: bold;">Player 1 (White)</div>
                    <div style="margin-left: 10px;"><span id="timer1"></span></div>
                    <div *ngIf="game.turn.value === 'W'" class="turn-badge">YOUR TURN</div>
                </div>
                <div class="row" *ngIf="game">
                    <div class="board-grid">
                        <!-- Empty corner -->
                        <div class="header-cell corner"></div>

                        <!-- Top File Headers (a-h) -->
                        <div *ngFor="let file of game.board.files" class="header-cell file-header"
                            [style.grid-column]="getGridColumn(file)" [style.grid-row]="1">
                            {{ file }}
                        </div>

                        <!-- Left Rank Headers (1-8) -->
                        <div *ngFor="let rank of game.board.ranks" class="header-cell rank-header"
                            [style.grid-row]="getGridRow(rank)" [style.grid-column]="1">
                            {{ rank }}
                        </div>

                        <!-- Squares and Pieces -->
                        <ng-container *ngFor="let item of game.board.cells">
                            <div (click)="clickBoard(item)" class="square"
                                [class.dark]="item.color === 'B'" [class.light]="item.color === 'W'"
                                [class.selected]="item.selected" [class.checked]="item.checked"
                                [style.grid-row]="getGridRow(item.rank)" [style.grid-column]="getGridColumn(item.file)">
                                <img *ngIf="getPiece(item)" src="./assets/images/pieces/{{getPiece(item)?.abbreviation}}.png">
                            </div>
                        </ng-container>
                    </div>
                </div>
                <div class="row player-indicator" [class.active]="game.turn.value === 'B'" *ngIf="game">
                    <div style="font-weight: bold;">Player 2 (Black)</div>
                    <div style="margin-left: 10px;"><span id="timer2"></span></div>
                    <div *ngIf="game.turn.value === 'B'" class="turn-badge">YOUR TURN</div>
                </div>
            </div>
            <div class="col-lg-4">
                <div *ngIf="!gameInitialized()">
                    <mat-label class="f-w-600 m-b-8 d-block">Time selector</mat-label>
                    <mat-form-field appearance="outline" class="w-100">
                        <mat-select [(value)]="selectedFormat">
                            @for(option of formats; track option.value) {
                            <mat-option [value]="option.value">{{
                                option.viewValue
                                }}
                            </mat-option>
                            }
                        </mat-select>
                    </mat-form-field>
                    <div>
                        @for(option of currentTimeOptions; track option.type) {
                        <button mat-flat-button (click)="selectTime(option)"
                            [class.selected]="selectedTimeOption === option" class="bg-success">
                            {{ option.label }}
                        </button>
                        <span *ngIf="!$last"> | </span>
                        }
                    </div>
                    <div class="m-t-12">
                        <button mat-flat-button color="primary" (click)="startGame()" class="m-r-8">Play</button>
                    </div>
                </div>
                <div *ngIf="game">
                    <h2>Game history</h2>
                    <ul class="history">
                        <li class="history-item" *ngFor="let entry of game.history">
                            <img src="./assets/images/pieces/{{entry.piece.abbreviation}}.png">
                            <span>{{entry.square}}</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </mat-card-content>
</mat-card>